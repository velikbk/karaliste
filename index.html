<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Kara Liste Sistemi</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { box-sizing: border-box; }
    
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      max-width: 1000px; 
      margin: 0 auto; 
      padding: 10px; 
      background: #f8f9fa;
      color: #333;
    }
    
    .container {
      background: white;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    input, textarea, button, select {
      width: 100%; 
      padding: 12px; 
      margin: 8px 0; 
      font-size: 16px; 
      border: 1px solid #ddd; 
      border-radius: 6px;
    }
    
    button {
      background: #007bff; 
      color: white; 
      border: none; 
      cursor: pointer;
    }
    
    button:hover { background: #0056b3; }
    
    .btn-danger { background: #dc3545; }
    .btn-success { background: #28a745; }
    .btn-small { padding: 6px 12px; font-size: 14px; width: auto; margin: 2px; }
    
    .table-container {
      overflow-x: auto;
      border: 1px solid #ddd;
      border-radius: 8px;
      margin-top: 15px;
    }
    
    table {
      width: 100%; 
      min-width: 600px;
      border-collapse: collapse; 
    }
    
    th, td {
      padding: 12px 8px; 
      border-bottom: 1px solid #eee; 
      text-align: left;
    }
    
    th {
      background: #f8f9fa; 
      position: sticky;
      top: 0;
      cursor: pointer;
    }
    
    .hidden { display: none; }
    .alert { padding: 12px; border-radius: 6px; margin: 10px 0; }
    .alert-success { background: #d4edda; color: #155724; }
    .alert-danger { background: #f8d7da; color: #721c24; }
    
    /* Mobile */
    @media (max-width: 768px) {
      body { padding: 5px; }
      .container { padding: 15px; }
      
      table { min-width: 500px; }
      th, td { padding: 8px 4px; font-size: 13px; }
      
      .col-tc { max-width: 80px; overflow: hidden; text-overflow: ellipsis; }
      .col-phone { max-width: 90px; overflow: hidden; text-overflow: ellipsis; }
      .col-reason { max-width: 120px; overflow: hidden; text-overflow: ellipsis; }
      
      .table-container::before {
        content: "← Kaydırabilirsiniz →";
        display: block;
        text-align: center;
        font-size: 12px;
        color: #666;
        padding: 8px;
        background: #f8f9fa;
      }
    }
  </style>
</head>
<body>
  <!-- Login -->
  <div id="loginSection" class="container">
    <h2>🔐 Giriş</h2>
    <input type="text" id="username" placeholder="Kullanıcı Adı" />
    <input type="password" id="password" placeholder="Şifre" />
    <button onclick="login()">Giriş Yap</button>
    <div id="loginMessage"></div>
    <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 6px;">
      <strong>Demo:</strong><br>
      Admin: admin / 123456<br>
      User: user / 123456
    </div>
  </div>

  <!-- Main Panel -->
  <div id="mainPanel" class="hidden">
    <div class="container">
      <h2>Kara Liste Paneli</h2>
      <p><strong>Kullanıcı:</strong> <span id="currentUser"></span> (<span id="currentRole"></span>)</p>
      <button onclick="logout()" class="btn-danger">Çıkış</button>
    </div>

    <!-- Admin Section -->
    <div id="adminSection" class="container hidden">
      <h3>👥 Kullanıcı Yönetimi</h3>
      <button onclick="showAddUserForm()" class="btn-success">+ Kullanıcı Ekle</button>
      
      <div id="addUserForm" class="hidden" style="margin-top: 15px; padding: 15px; background: #f8f9fa;">
        <input type="text" id="newUsername" placeholder="Kullanıcı adı" />
        <input type="password" id="newPassword" placeholder="Şifre" />
        <select id="newRole">
          <option value="user">User</option>
          <option value="admin">Admin</option>
        </select>
        <button onclick="addUser()" class="btn-success">Kaydet</button>
        <button onclick="hideAddUserForm()" style="background: #6c757d;">İptal</button>
        <div id="addUserMessage"></div>
      </div>

      <div class="table-container">
        <table>
          <thead>
            <tr><th>Kullanıcı</th><th>Rol</th><th>Son Giriş</th><th>İşlem</th></tr>
          </thead>
          <tbody id="usersList"></tbody>
        </table>
      </div>
    </div>

    <!-- Add Person -->
    <div class="container">
      <h3>➕ Kişi Ekle</h3>
      <input type="text" id="personName" placeholder="İsim Soyisim" />
      <input type="text" id="personTC" placeholder="TC Kimlik" maxlength="11" />
      <input type="text" id="personPhone" placeholder="Telefon" />
      <textarea id="personReason" placeholder="Neden?" rows="3"></textarea>
      <button onclick="addPerson()">Ekle</button>
      <div id="addPersonMessage"></div>
    </div>

    <!-- Blacklist -->
    <div class="container">
      <h3>🔍 Kara Liste</h3>
      <input type="text" id="searchInput" placeholder="Ara..." oninput="filterList()" />
      
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th onclick="sortTable('name')">İsim</th>
              <th onclick="sortTable('tc')" class="col-tc">TC</th>
              <th onclick="sortTable('phone')" class="col-phone">Telefon</th>
              <th onclick="sortTable('reason')" class="col-reason">Neden</th>
              <th id="addedByHeader" class="hidden">Ekleyen</th>
              <th>İşlem</th>
            </tr>
          </thead>
          <tbody id="blacklistBody"></tbody>
        </table>
      </div>
    </div>

    <!-- History -->
    <div class="container">
      <h3>📜 Silinen Kayıtlar</h3>
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>İsim</th><th class="col-tc">TC</th><th class="col-phone">Telefon</th>
              <th class="col-reason">Neden</th><th class="col-reason">Silme Nedeni</th>
              <th>Tarih</th><th id="deletedByHeader" class="hidden">Silen</th>
            </tr>
          </thead>
          <tbody id="historyBody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    let currentUser = null;
    let users = [
      { id: 1, username: 'admin', password: '123456', role: 'admin', lastLogin: null },
      { id: 2, username: 'user', password: '123456', role: 'user', lastLogin: null }
    ];
    let blacklist = [];
    let deletedRecords = [];
    let sortField = '', sortDirection = 'asc';

    window.onload = function() {
      loadData();
      checkLogin();
    };

    function loadData() {
      const savedUsers = localStorage.getItem('karaliste_users');
      if (savedUsers) users = JSON.parse(savedUsers);
      
      const savedBlacklist = localStorage.getItem('karaliste_blacklist');
      if (savedBlacklist) blacklist = JSON.parse(savedBlacklist);
      
      const savedDeleted = localStorage.getItem('karaliste_deleted');
      if (savedDeleted) deletedRecords = JSON.parse(savedDeleted);
    }

    function saveData() {
      localStorage.setItem('karaliste_users', JSON.stringify(users));
      localStorage.setItem('karaliste_blacklist', JSON.stringify(blacklist));
      localStorage.setItem('karaliste_deleted', JSON.stringify(deletedRecords));
    }

    function checkLogin() {
      const savedUser = localStorage.getItem('karaliste_currentuser');
      if (savedUser) {
        currentUser = JSON.parse(savedUser);
        showMainPanel();
      } else {
        showLoginSection();
      }
    }

    function login() {
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value.trim();
      
      const user = users.find(u => u.username === username && u.password === password);
      
      if (user) {
        user.lastLogin = new Date().toISOString();
        currentUser = user;
        localStorage.setItem('karaliste_currentuser', JSON.stringify(currentUser));
        saveData();
        showMessage('loginMessage', 'Giriş başarılı!', 'success');
        setTimeout(showMainPanel, 1000);
      } else {
        showMessage('loginMessage', 'Hatalı giriş!', 'danger');
      }
    }

    function logout() {
      localStorage.removeItem('karaliste_currentuser');
      currentUser = null;
      showLoginSection();
    }

    function showLoginSection() {
      document.getElementById('loginSection').classList.remove('hidden');
      document.getElementById('mainPanel').classList.add('hidden');
    }

    function showMainPanel() {
      document.getElementById('loginSection').classList.add('hidden');
      document.getElementById('mainPanel').classList.remove('hidden');
      
      document.getElementById('currentUser').textContent = currentUser.username;
      document.getElementById('currentRole').textContent = currentUser.role;
      
      if (currentUser.role === 'admin') {
        document.getElementById('adminSection').classList.remove('hidden');
        document.getElementById('addedByHeader').classList.remove('hidden');
        document.getElementById('deletedByHeader').classList.remove('hidden');
        updateUsersList();
      }
      
      updateBlacklistTable();
      updateHistoryTable();
    }

    function showAddUserForm() {
      document.getElementById('addUserForm').classList.remove('hidden');
    }

    function hideAddUserForm() {
      document.getElementById('addUserForm').classList.add('hidden');
    }

    function addUser() {
      const username = document.getElementById('newUsername').value.trim();
      const password = document.getElementById('newPassword').value.trim();
      const role = document.getElementById('newRole').value;
      
      if (!username || !password) {
        showMessage('addUserMessage', 'Eksik bilgi!', 'danger');
        return;
      }
      
      if (users.find(u => u.username === username)) {
        showMessage('addUserMessage', 'Kullanıcı mevcut!', 'danger');
        return;
      }
      
      users.push({
        id: Date.now(),
        username: username,
        password: password,
        role: role,
        lastLogin: null
      });
      
      saveData();
      updateUsersList();
      hideAddUserForm();
    }

    function updateUsersList() {
      const tbody = document.getElementById('usersList');
      tbody.innerHTML = '';
      
      users.forEach(user => {
        const lastLogin = user.lastLogin ? new Date(user.lastLogin).toLocaleString('tr-TR') : 'Hiç';
        tbody.innerHTML += `
          <tr>
            <td>${user.username}</td>
            <td>${user.role}</td>
            <td>${lastLogin}</td>
            <td>
              <button onclick="deleteUser(${user.id})" class="btn-small btn-danger">Sil</button>
            </td>
          </tr>
        `;
      });
    }

    function deleteUser(userId) {
      if (userId === currentUser.id) {
        alert('Kendi hesabınızı silemezsiniz!');
        return;
      }
      users = users.filter(u => u.id !== userId);
      saveData();
      updateUsersList();
    }

    function addPerson() {
      const name = document.getElementById('personName').value.trim();
      const tc = document.getElementById('personTC').value.trim();
      const phone = document.getElementById('personPhone').value.trim();
      const reason = document.getElementById('personReason').value.trim();
      
      if (!name || !tc || !reason) {
        showMessage('addPersonMessage', 'İsim, TC ve neden zorunlu!', 'danger');
        return;
      }
      
      if (tc.length !== 11 || !/^\d+$/.test(tc)) {
        showMessage('addPersonMessage', 'TC 11 haneli olmalı!', 'danger');
        return;
      }
      
      if (blacklist.find(p => p.tc === tc)) {
        showMessage('addPersonMessage', 'TC zaten kayıtlı!', 'danger');
        return;
      }
      
      blacklist.push({
        id: Date.now(),
        name, tc, phone, reason,
        addedBy: currentUser.username,
        addedAt: new Date().toISOString()
      });
      
      saveData();
      updateBlacklistTable();
      
      // Clear form
      ['personName', 'personTC', 'personPhone', 'personReason'].forEach(id => {
        document.getElementById(id).value = '';
      });
      
      showMessage('addPersonMessage', 'Eklendi!', 'success');
    }

    function deletePerson(personId) {
      const person = blacklist.find(p => p.id === personId);
      const deleteReason = prompt('Silme nedeni:');
      
      if (!deleteReason) return;
      
      deletedRecords.push({
        ...person,
        deletedBy: currentUser.username,
        deletedAt: new Date().toISOString(),
        deleteReason: deleteReason
      });
      
      blacklist = blacklist.filter(p => p.id !== personId);
      saveData();
      updateBlacklistTable();
      updateHistoryTable();
    }

    function updateBlacklistTable() {
      const tbody = document.getElementById('blacklistBody');
      tbody.innerHTML = '';
      
      blacklist.forEach(person => {
        tbody.innerHTML += `
          <tr>
            <td>${person.name}</td>
            <td class="col-tc">${person.tc}</td>
            <td class="col-phone">${person.phone || '-'}</td>
            <td class="col-reason">${person.reason}</td>
            <td class="${currentUser.role === 'admin' ? '' : 'hidden'}">${person.addedBy || '-'}</td>
            <td><button onclick="deletePerson(${person.id})" class="btn-small btn-danger">Sil</button></td>
          </tr>
        `;
      });
    }

    function updateHistoryTable() {
      const tbody = document.getElementById('historyBody');
      tbody.innerHTML = '';
      
      deletedRecords.forEach(record => {
        tbody.innerHTML += `
          <tr>
            <td>${record.name}</td>
            <td class="col-tc">${record.tc}</td>
            <td class="col-phone">${record.phone || '-'}</td>
            <td class="col-reason">${record.reason}</td>
            <td class="col-reason">${record.deleteReason}</td>
            <td>${new Date(record.deletedAt).toLocaleString('tr-TR')}</td>
            <td class="${currentUser.role === 'admin' ? '' : 'hidden'}">${record.deletedBy}</td>
          </tr>
        `;
      });
    }

    function filterList() {
      const search = document.getElementById('searchInput').value.toLowerCase();
      const rows = document.querySelectorAll('#blacklistBody tr');
      
      rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(search) ? '' : 'none';
      });
    }

    function sortTable(field) {
      if (sortField === field) {
        sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
      } else {
        sortField = field;
        sortDirection = 'asc';
      }
      updateBlacklistTable();
    }

    function showMessage(elementId, message, type) {
      document.getElementById(elementId).innerHTML = `<div class="alert alert-${type}">${message}</div>`;
    }
  </script>
</body>
</html>
