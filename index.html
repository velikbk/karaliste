<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Kara Liste Yönetimi</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <style>
    body {
      font-family: sans-serif;
      max-width: 600px;
      margin: 20px auto;
      padding: 20px;
    }
    input, textarea, button {
      width: 100%;
      padding: 10px;
      margin: 6px 0;
      font-size: 16px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    button {
      background: #007bff;
      color: white;
      font-weight: bold;
      border: none;
    }
    table {
      width: 100%;
      margin-top: 20px;
      border-collapse: collapse;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    .sil-btn {
      background: #dc3545;
      color: white;
      padding: 6px;
      border: none;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <h2>Kara Liste Kayıt Ekle</h2>
  <input type="text" id="isim" placeholder="İsim">
  <input type="text" id="tc" placeholder="TC Kimlik No">
  <input type="text" id="telefon" placeholder="Telefon">
  <textarea id="neden" placeholder="Neden kara listeye alındı?"></textarea>
  <button onclick="ekle()">Ekle</button>
  <p id="sonuc"></p>

  <h2>Kara Liste</h2>
  <input type="text" id="arama" placeholder="İsim, TC veya neden ara..." onkeyup="filtrele()">

  <table id="listeTablosu">
    <thead>
      <tr>
        <th>İsim</th>
        <th>TC</th>
        <th>Telefon</th>
        <th>Neden</th>
        <th>Sil</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const supabaseUrl = 'https://agfeuszcreycpandzfij.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFnZmV1c3pjcmV5Y3BhbmR6ZmlqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA2MjA3NDYsImV4cCI6MjA2NjE5Njc0Nn0.ap9UUJfPECk0Xysn53q8WIBaH1QDKMPrGTCrGzfEn_s';
    const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

    async function ekle() {
      const isim = document.getElementById('isim').value.trim();
      const tc = document.getElementById('tc').value.trim();
      const telefon = document.getElementById('telefon').value.trim();
      const neden = document.getElementById('neden').value.trim();

      if (!isim || !tc || !neden) {
        document.getElementById('sonuc').innerText = "İsim, TC ve neden zorunludur.";
        return;
      }

      const { error } = await supabase
        .from('blacklist')
        .insert([{
          isim,
          tc,
          telefon,
          neden
        }]);

      if (error) {
        document.getElementById('sonuc').innerText = "Hata: " + error.message;
      } else {
        document.getElementById('sonuc').innerText = "✅ Kayıt eklendi.";
        document.getElementById('isim').value = "";
        document.getElementById('tc').value = "";
        document.getElementById('telefon').value = "";
        document.getElementById('neden').value = "";
        listele();
      }
    }

    async function listele() {
      const { data, error } = await supabase
        .from('blacklist')
        .select('*');

      const tbody = document.querySelector("#listeTablosu tbody");
      tbody.innerHTML = "";

      if (error) {
        tbody.innerHTML = "<tr><td colspan='5'>Hata oluştu</td></tr>";
        return;
      }

      data.forEach(kisi => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${kisi.isim}</td>
          <td>${kisi.tc}</td>
          <td>${kisi.telefon}</td>
          <td>${kisi.neden}</td>
          <td><button class="sil-btn" onclick="sil('${kisi.id}')">Sil</button></td>
        `;
        tbody.appendChild(tr);
      });
    }

    async function sil(id) {
      const onay = confirm("Bu kaydı silmek istediğine emin misin?");
      if (!onay) return;

      const { error } = await supabase
        .from('blacklist')
        .delete()
        .eq('id', id);

      if (error) {
        alert("Silme hatası: " + error.message);
      } else {
        alert("Kayıt silindi");
        listele();
      }
    }

    function filtrele() {
      const arama = document.getElementById('arama').value.toLowerCase();
      const satirlar = document.querySelectorAll("#listeTablosu tbody tr");

      satirlar.forEach(tr => {
        const metin = tr.innerText.toLowerCase();
        if (metin.includes(arama)) {
          tr.style.display = "";
        } else {
          tr.style.display = "none";
        }
      });
    }

    listele(); // Sayfa yüklenince otomatik listele
  </script>
</body>
</html>
